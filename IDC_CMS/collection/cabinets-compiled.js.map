{"version":3,"sources":["cabinets.js"],"names":[],"mappings":"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","file":"cabinets-compiled.js","sourcesContent":["//导入Cabinets对象模型\r\nconst Cabinets = require('../modules/cabinet');\r\n//导入 机房模型以及用途模型\r\nconst Engine = require('../modules/engineRoom');\r\nconst Use = require('../modules/use');\r\n\r\n//---------------机柜cabinets get方法路由\r\nexports.getCabinets = (req,res) => {\r\n  //查询机房\r\n  Engine.find({},null,(err,engineData) => {\r\n    if(err){\r\n      return res.json({'postStatus':'error','msg':'机房查询失败'});\r\n    }\r\n    //查询通途\r\n    Use.find({},null,(err,useData) => {\r\n      if(err){\r\n        return res.json({'postStatus':'error','msg':'用途查询失败'});\r\n      }\r\n      //关联查询\r\n      Cabinets\r\n        .find({})\r\n        .populate('cabinetsRoom')\r\n        .populate('cabinetsUse')\r\n        // .populate('Use')\r\n        .exec((err,info) => {\r\n          if(err){\r\n            return res.json({'postStatus':'查询有误，无法查询'});\r\n          }\r\n          //渲染页面\r\n          return res.render('cabinets',{\r\n            title: '机柜管理',\r\n            session: req.session.username,\r\n            engineDocs:engineData,\r\n            useDocs: useData,\r\n            docs: info\r\n          });\r\n        });\r\n    });\r\n  });\r\n};\r\n\r\n//---------------机柜cabinets 删除信息\r\n\r\nexports.deleteCabinets = (req,res) => {\r\n  //获取id信息\r\n  let id = req.query.id;\r\n  Cabinets.remove({'_id':id},(err) => {\r\n    if(err){\r\n      return res.json({'postStatus':'error','msg':'机柜删除失败,请稍后再试'});\r\n    }\r\n    return res.redirect('back');\r\n  });\r\n};\r\n\r\n//----------------机柜cabinets post 逻辑处理\r\nexports.postCabinets = (req,res) => {\r\n  //获取表单信息\r\n  let cabinetsId = req.body.cabinetsId;\r\n  let cabinetsU = req.body.cabinetsU;\r\n  let cabinetsPower = req.body.cabinetsPower;\r\n  let cabinetsRoom = [req.body.cabinetsRoom];\r\n  let cabinetsUse = [req.body.cabinetsUse];\r\n  //准备吸入到mongodb\r\n  Cabinets.create({\r\n    'cabinetsId':cabinetsId,\r\n    'cabinetsU':cabinetsU,\r\n    'cabinetsPower':cabinetsPower,\r\n    'cabinetsRoom':cabinetsRoom,\r\n    'cabinetsUse':cabinetsUse\r\n  },(err,data) => {\r\n    if(err){\r\n      return res.json({'postStatus':'error','msg':'机柜添加失败,请稍后再试'});\r\n    }\r\n    return res.json({'postStatus':'success','msg':'机柜添加完成'});\r\n  });\r\n};\r\n\r\n//-------------------------------机柜更新\r\nexports.updateCab = (req,res) => {\r\n  let id = req.body.id;\r\n  let cabinetsId = req.body.cabinetsIds;\r\n  let cabinetsU = req.body.cabinetsUs;\r\n  let cabinetsPower = req.body.cabinetsPowers;\r\n  let cabinetsRoom = req.body.cabinetsRooms;\r\n  let cabinetsUse = req.body.cabinetsUses;\r\n  //更新机柜\r\n  Cabinets.update({'_id':id},{\r\n    'cabinetsId':cabinetsId,\r\n    'cabinetsU':cabinetsU,\r\n    'cabinetsPower':cabinetsPower,\r\n    'cabinetsRoom':cabinetsRoom,\r\n    'cabinetsUse':cabinetsUse\r\n  },(err) => {\r\n    if(err){\r\n      return res.json({'postStatus':'error','msg':'机柜更新失败'});\r\n    }\r\n    return res.json({'postStatus':'success','msg':'机柜更新完成'});\r\n  });\r\n};"]}